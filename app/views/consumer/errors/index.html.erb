<%# Consumer Errors - Screen 4: Errors & Blocks %>
<%# Purpose: Actionable error logs with fix suggestions - Reduces 80% of support load %>

<div class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50">
  <%= render 'consumer/shared/header', active: 'errors' %>

  <%# Main Content %>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <%# Header with Filters %>
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Errors & Blocks</h1>
        <p class="text-gray-600 mt-1">View errors with actionable fix suggestions</p>
      </div>

      <%# Filter Buttons %>
      <div class="btn-group">
        <a href="<%= consumer_errors_path %>" class="btn btn-sm <%= @error_type == 'all' ? 'btn-active' : '' %>">All</a>
        <a href="<%= consumer_errors_path(filter: '429') %>" class="btn btn-sm <%= @error_type == '429' ? 'btn-active' : '' %>">429</a>
        <a href="<%= consumer_errors_path(filter: '401') %>" class="btn btn-sm <%= @error_type == '401' ? 'btn-active' : '' %>">401</a>
        <a href="<%= consumer_errors_path(filter: '403') %>" class="btn btn-sm <%= @error_type == '403' ? 'btn-active' : '' %>">403</a>
        <a href="<%= consumer_errors_path(filter: '5xx') %>" class="btn btn-sm <%= @error_type == '5xx' ? 'btn-active' : '' %>">5xx</a>
      </div>
    </div>

    <%# Errors List %>
    <div class="space-y-4">
      <% if @errors.any? %>
        <% @errors.each do |error_data| %>
          <% error = error_data[:error] %>
          <% status_code = error_data[:status_code] %>
          <% suggestion = error_data[:suggestion] %>

          <div class="card bg-white shadow-lg hover:shadow-xl transition-shadow">
            <div class="card-body">
              <div class="flex items-start gap-4">
                <%# Status Icon %>
                <div class="flex-shrink-0">
                  <div class="w-12 h-12 rounded-full flex items-center justify-center <%= status_code.to_i >= 500 ? 'bg-red-100' : status_code.to_i == 429 ? 'bg-yellow-100' : 'bg-orange-100' %>">
                    <% if status_code.to_i >= 500 %>
                      <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                      </svg>
                    <% elsif status_code.to_i == 429 %>
                      <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                    <% else %>
                      <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636" />
                      </svg>
                    <% end %>
                  </div>
                </div>

                <%# Error Details %>
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="badge <%= status_code.to_i >= 500 ? 'badge-error' : status_code.to_i == 429 ? 'badge-warning' : 'badge-error' %> badge-lg">
                      <%= status_code %>
                    </span>
                    <span class="text-sm text-gray-500">
                      <%= time_ago_in_words(error.timestamp) %> ago
                    </span>
                  </div>

                  <div class="font-mono text-sm text-gray-700 mb-2">
                    <%= error.metadata&.dig('method') || 'GET' %>
                    <span class="font-semibold"><%= error.metadata&.dig('endpoint') || error.event_type %></span>
                  </div>

                  <%# Error Reason %>
                  <div class="bg-gray-50 rounded-lg p-3 mb-3">
                    <div class="flex items-start">
                      <svg class="w-5 h-5 text-gray-400 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      <div class="flex-1">
                        <div class="text-sm font-semibold text-gray-700 mb-1">
                          <%= suggestion[:reason] %>
                        </div>
                        <div class="text-sm text-gray-600">
                          <%= error.event_type.humanize %>
                        </div>
                      </div>
                    </div>
                  </div>

                  <%# Suggested Fix %>
                  <div class="bg-blue-50 border-l-4 border-blue-500 rounded p-3">
                    <div class="flex items-start">
                      <svg class="w-5 h-5 text-blue-600 mr-2 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                      </svg>
                      <div class="flex-1">
                        <div class="text-sm font-semibold text-blue-900 mb-1">
                          Suggested Fix:
                        </div>
                        <div class="text-sm text-blue-800">
                          <%= suggestion[:suggestion] %>
                        </div>

                        <% if suggestion[:action_url] && suggestion[:action_url] != '#' %>
                          <div class="mt-3">
                            <a href="<%= suggestion[:action_url] %>" class="btn btn-sm btn-primary gap-2">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6" />
                              </svg>
                              <%= case suggestion[:action]
                                  when 'upgrade_tier' then 'Upgrade Tier'
                                  when 'view_keys' then 'View API Keys'
                                  when 'rotate_key' then 'Rotate Key'
                                  when 'contact_support' then 'Contact Support'
                                  when 'status_page' then 'View Status'
                                  else 'Take Action'
                                  end %>
                            </a>
                          </div>
                        <% end %>
                      </div>
                    </div>
                  </div>

                  <%# Additional Metadata %>
                  <% if error.metadata&.dig('ip_address') %>
                    <div class="text-xs text-gray-500 mt-2">
                      IP: <%= error.metadata['ip_address'] %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        <% end %>

        <%# Load More (if we implement pagination) %>
        <% if @errors.size >= 50 %>
          <div class="text-center py-4">
            <button class="btn btn-outline" disabled>
              Showing last 50 errors
            </button>
          </div>
        <% end %>

      <% else %>
        <%# Empty State %>
        <div class="card bg-white shadow-xl">
          <div class="card-body text-center py-16">
            <div class="flex flex-col items-center">
              <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mb-4">
                <svg class="w-10 h-10 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
              </div>
              <h3 class="text-xl font-bold text-gray-900 mb-2">
                <%= @error_type == 'all' ? 'No Errors Found' : "No #{@error_type} Errors Found" %> ðŸŽ‰
              </h3>
              <p class="text-gray-600 mb-4">Your API requests are running smoothly!</p>
              <% if @error_type != 'all' %>
                <a href="<%= consumer_errors_path %>" class="btn btn-ghost btn-sm">
                  View All Errors
                </a>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    </div>

    <%# Help Card %>
    <div class="card bg-gradient-to-br from-purple-500 to-indigo-600 text-white shadow-xl mt-8">
      <div class="card-body">
        <h3 class="card-title">Need Help?</h3>
        <p class="text-sm opacity-90 mb-4">
          If these suggestions don't resolve your issue, our support team is here to help.
        </p>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
          <a href="#" class="btn btn-outline text-white border-white hover:bg-white hover:text-purple-600 gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
            </svg>
            Documentation
          </a>
          <a href="#" class="btn btn-outline text-white border-white hover:bg-white hover:text-purple-600 gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
            Live Chat
          </a>
          <a href="#" class="btn btn-outline text-white border-white hover:bg-white hover:text-purple-600 gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            Email Support
          </a>
        </div>
      </div>
    </div>

    <%# Common Error Codes Reference %>
    <div class="collapse collapse-arrow bg-white shadow-xl mt-8">
      <input type="checkbox" />
      <div class="collapse-title text-lg font-medium">
        ðŸ“š Common HTTP Error Codes Reference
      </div>
      <div class="collapse-content">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
          <div class="bg-gray-50 p-3 rounded">
            <div class="font-semibold text-red-600 mb-1">401 Unauthorized</div>
            <div class="text-gray-600">Invalid or missing API key</div>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <div class="font-semibold text-red-600 mb-1">403 Forbidden</div>
            <div class="text-gray-600">Insufficient permissions or IP blocked</div>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <div class="font-semibold text-yellow-600 mb-1">429 Too Many Requests</div>
            <div class="text-gray-600">Rate limit exceeded</div>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <div class="font-semibold text-red-600 mb-1">500 Internal Server Error</div>
            <div class="text-gray-600">Server-side issue</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
